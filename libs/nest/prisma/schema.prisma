generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["linux-arm64-openssl-1.1.x", "native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator zod {
  provider                         = "zod-prisma-types"
  output                           = "../src/zod/generated" // default is ./generated/custom
  useMultipleFiles                 = true // default is false
  writeBarrelFiles                 = true // default is true
  createInputTypes                 = false // default is true
  createModelTypes                 = true // default is true
  addInputTypeValidation           = false // default is true
  addIncludeType                   = false // default is true
  addSelectType                    = false // default is true
  validateWhereUniqueInput         = false // default is false
  createOptionalDefaultValuesTypes = false // default is false
  createRelationValuesTypes        = false // default is false
  createPartialTypes               = false // default is false
  useDefaultValidators             = false // default is true
  coerceDate                       = true // default is true
  writeNullishInModelTypes         = false // default is false
  // prismaClientPath                 = "./path/to/prisma/client" // default is client output path
}

/// @namespace Actions
/// @erd action_templates
/// @erd actions
/// @describe Action Templates are a way to define a set of actions that can be taken by a user in the app.  Action Templates are then used to create Actions that are specific to an organization.
/// @zod.import(["import { ActionTemplateSchema } from '../../custom'"])
model action_templates {
  id         String    @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  template   Json /// @zod.custom.use(ActionTemplateSchema)
  /// @DtoUpdateHidden
  created_at DateTime  @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at DateTime  @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  actions    actions[]
}

/// @namespace Actions
/// @erd organizations
/// @erd action_templates
/// @erd actions
/// @describe *Actions* are defined by an *Action Template* and are specific to an organization.
/// @zod.import(["import { ActionTemplateSchema } from '../../custom'"])
model actions {
  id                 String           @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  action             Json /// @zod.custom.use(ActionTemplateSchema)
  action_template_id String /// @zod.custom.use(z.string().uuid())
  organization_id    String /// @zod.custom.use(z.string().uuid())
  /// @DtoRelationRequired
  action_template    action_templates @relation(fields: [action_template_id], references: [id], onDelete: Cascade)
  /// @DtoRelationRequired
  organization       organizations    @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  /// @DtoUpdateHidden
  created_at         DateTime         @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at         DateTime         @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
}

/// @namespace News
/// @describe News is a way to share climate information with users of the app.
model news {
  id           String   @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  title        String
  url          String /// @zod.custom.use(z.string().url())
  image_url    String /// @zod.custom.use(z.string().url())
  publish      Boolean  @default(false)
  published_at DateTime
  source_name  String
  /// @DtoUpdateHidden
  created_at   DateTime @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at   DateTime @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
}

/// @namespace Component Definitions
/// @describe Component definitions describe how a component should be rendered in the UI
model component_definitions {
  /// @DtoReadOnly
  /// #DtoHide
  id          String                     @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  name        String                     @unique
  type        component_definition_types
  description String /// @zod.custom.use(z.string())
  definition  Json
  /// @DtoUpdateHidden
  created_at  DateTime                   @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at  DateTime                   @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
}

/// @namespace Policies
/// @describe Policy Definitions are a set of content policies (ie: Privacy & ToS)
/// @erd policy_data
model policy_definitions {
  id          Int           @id @default(autoincrement()) /// @zod.custom.use(z.number().int().positive())
  name        String
  definition  String
  /// @DtoUpdateHidden
  created_at  DateTime      @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at  DateTime      @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  policy_data policy_data[]
}

/// @namespace Policies
/// @describe Policy Definitions are a set of content policies (ie: Privacy & ToS)
/// @erd policy_definitions
model policy_data {
  email             String /// @zod.custom.use(z.string().email())
  id                Int /// @zod.custom.use(z.number().int().positive())
  /// @DtoUpdateHidden
  created_at        DateTime            @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at        DateTime            @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  /// @DtoRelationRequired
  policy_definition policy_definitions? @relation(fields: [id], references: [id], onDelete: Cascade)

  @@unique([email, id])
}

/// @namespace Surveys
/// @erd survey_data
/// @erd organizations
/// @zod.import(["import { SurveyDefinitionSchema } from '../../custom'"])
model survey_definitions {
  id          String        @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  name        String        @unique
  type        survey_types /// @z.enum()
  description String
  /// @DtoUpdateHidden
  created_at  DateTime      @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at  DateTime      @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  definition  Json /// @zod.custom.use(SurveyDefinitionSchema)
  survey_data survey_data[]
}

/// @namespace Surveys
/// @erd organizations
/// @zod.import(["import { SurveyDefinitionSchema } from '../../custom'"])
model survey_data {
  id                   String             @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  survey_definition_id String /// @zod.custom.use(z.string().uuid())
  organization_id      String /// @zod.custom.use(z.string().uuid())
  data                 Json /// @zod.custom.use(SurveyDefinitionSchema.optional())
  /// @DtoUpdateHidden
  created_at           DateTime           @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at           DateTime           @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  /// @DtoRelationRequired
  organizations        organizations      @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  /// @DtoRelationRequired
  survey_definition    survey_definitions @relation(fields: [survey_definition_id], references: [id], onDelete: Cascade)

  @@unique([id])
}

/// @namespace Categories
/// @erd category_data
/// @erd organizations
/// @zod.import(["import { CategoryDefinitionSchema } from '../../custom'"])
model category_definitions {
  id            String          @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  name          String          @unique
  description   String
  /// @DtoUpdateHidden
  created_at    DateTime        @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at    DateTime        @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  definition    Json /// @zod.custom.use(CategoryDefinitionSchema)
  category_data category_data[]
}

/// @namespace Categories
/// @erd category_definitions
/// @erd organizations
/// @zod.import(["import { CategoryDefinitionSchema } from '../../custom'"])
model category_data {
  id                     String               @id @default(uuid())
  category_definition_id String /// @zod.custom.use(z.string().uuid())
  organization_id        String /// @zod.custom.use(z.string().uuid())
  data                   Json /// @zod.custom.use(CategoryDefinitionSchema.optional())
  /// @DtoUpdateHidden
  created_at             DateTime             @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at             DateTime             @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  /// @DtoRelationRequired
  organizations          organizations        @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  /// @DtoRelationRequired
  category_definition    category_definitions @relation(fields: [category_definition_id], references: [id], onDelete: Cascade)

  @@unique([id])
}

/// @namespace Categories
/// @erd category_data
/// @erd survey_data
/// @actions
model organizations {
  id                  String          @id @default(uuid()) /// @zod.custom.use(z.string().uuid())
  name                String          @unique
  enabled_connections Json
  display_name        String
  branding            Json?
  phone               String?
  email               String? /// @zod.custom.use(z.string().email())
  street_address      String?
  city                String?
  state               String?
  zip                 String?
  /// @DtoUpdateHidden
  created_at          DateTime        @default(now()) /// @zod.custom.use(z.date().optional())
  /// @DtoUpdateHidden
  /// @DtoCreateHidden
  /// @DtoReadOnly
  updated_at          DateTime        @default(now()) @updatedAt /// @zod.custom.use(z.date().optional())
  survey_data         survey_data[]
  category_data       category_data[]
  actions             actions[]
  isTest              Boolean         @default(false)
}

enum survey_types {
  JOURNEY
  FOOTPRINT
  ENRICHMENT
  SOLUTION
  TEST
}

enum component_definition_types {
  UNKNOWN
  FORM
  NAVIGATION_SIDE
  NAVIGATION_HEADER
  NAVIGATION_FOOTER
  DATAGRID
  TEST
}

enum emissions_categories {
  ELECTRICITY
  FUEL
  WASTE
  WATER
  TRANSPORTATION
  OTHER
  TEST
}
